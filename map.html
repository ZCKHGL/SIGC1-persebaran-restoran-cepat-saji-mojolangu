<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        
        /* macOS-style minimalistic UI */
        .leaflet-control {
            border: none !important;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15) !important;
        }
        
        .leaflet-bar {
            border: none !important;
            border-radius: 8px !important;
            overflow: hidden;
            backdrop-filter: blur(8px) saturate(120%);
            -webkit-backdrop-filter: blur(8px) saturate(120%);
            background: rgba(255, 255, 255, 0.83) !important;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1) !important;
        }
        
        .leaflet-bar a {
            background: transparent !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
            color: #333 !important;
            transition: all 0.2s ease;
        }
        
        .leaflet-bar a:hover {
            background: rgba(0, 0, 0, 0.05) !important;
        }
        
        .leaflet-bar a:last-child {
            border-bottom: none !important;
        }
        
        .info, .abstractUncollapsed {
            padding: 15px 20px !important;
            background: rgba(255, 255, 255, 0.80) !important;
            backdrop-filter: blur(10px) saturate(120%) !important;
            -webkit-backdrop-filter: blur(10px) saturate(120%) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.05) !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
        }
        
        .info h2 {
            margin: 0 0 5px 0;
            color: #1d1d1f;
            font-size: 17px;
            font-weight: 600;
            letter-spacing: -0.2px;
        }
        
        .info p {
            margin: 0;
        }
        
        .abstractUncollapsed {
            font-size: 13px;
            color: #6e6e73;
            line-height: 1.5;
            position: relative;
        }
        
        .abstractUncollapsed h3 {
            font-size: 15px;
            font-weight: 600;
            color: #1d1d1f;
            margin: 0 0 10px 0;
            padding-right: 30px;
        }
        
        .abstract-toggle-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.05);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer !important;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 0;
            pointer-events: auto !important;
            z-index: 1000;
        }
        
        .abstract-toggle-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }
        
        .abstract-toggle-btn i {
            font-size: 14px;
            color: #1d1d1f;
        }
        
        .abstractCollapsed {
            padding: 0 !important;
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }
        
        .abstractCollapsed .abstract-collapsed-btn {
            background: rgba(255, 255, 255, 0.80) !important;
            backdrop-filter: blur(10px) saturate(120%) !important;
            -webkit-backdrop-filter: blur(10px) saturate(120%) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.05) !important;
            cursor: pointer !important;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            pointer-events: auto !important;
            z-index: 1000;
        }
        
        .abstractCollapsed .abstract-collapsed-btn:hover {
            background: rgba(255, 255, 255, 0.95) !important;
        }
        
        .abstractCollapsed .abstract-collapsed-btn i {
            font-size: 16px;
            color: #1d1d1f;
        }
        
        body.dark-theme .abstractUncollapsed {
            background: rgba(30, 30, 30, 0.80) !important;
        }
        
        body.dark-theme .abstractUncollapsed h3 {
            color: #ffffff !important;
        }
        
        body.dark-theme .abstractUncollapsed p {
            color: #a1a1a6 !important;
        }
        
        body.dark-theme .abstract-toggle-btn {
            background: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-theme .abstract-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        body.dark-theme .abstract-toggle-btn i {
            color: #ffffff;
        }
        
        body.dark-theme .abstractCollapsed .abstract-collapsed-btn {
            background: rgba(40, 40, 40, 0.80) !important;
        }
        
        body.dark-theme .abstractCollapsed .abstract-collapsed-btn:hover {
            background: rgba(60, 60, 60, 0.95) !important;
        }
        
        body.dark-theme .abstractCollapsed .abstract-collapsed-btn i {
            color: #ffffff;
        }
        
        .leaflet-control-layers {
            background: rgba(255, 255, 255, 0.83) !important;
            backdrop-filter: blur(8px) saturate(120%);
            -webkit-backdrop-filter: blur(8px) saturate(120%);
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px !important;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1) !important;
        }
        
        .leaflet-control-layers-toggle {
            background: transparent !important;
            width: 36px !important;
            height: 36px !important;
        }
        
        .leaflet-control-layers-list {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
        }
        
        .leaflet-control-measure {
            background: rgba(255, 255, 255, 0.85) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .leaflet-popup-content-wrapper {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 10px !important;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2) !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
        }
        
        .leaflet-popup-tip {
            background: rgba(255, 255, 255, 0.95) !important;
        }
        
        /* Custom search control styling */
        .leaflet-control-custom {
            background: rgba(255, 255, 255, 0.83) !important;
            backdrop-filter: blur(8px) saturate(120%);
            -webkit-backdrop-filter: blur(8px) saturate(120%);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1) !important;
        }
        
        .leaflet-control-custom input {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
            border: 1px solid rgba(0, 0, 0, 0.1) !important;
            font-size: 13px;
            transition: all 0.2s ease;
        }
        
        .leaflet-control-custom input:focus {
            outline: none;
            border-color: rgba(0, 122, 255, 0.5) !important;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        
        /* Theme Toggle Button */
        .theme-toggle {
            background: rgba(255, 255, 255, 0.83) !important;
            backdrop-filter: blur(8px) saturate(120%);
            -webkit-backdrop-filter: blur(8px) saturate(120%);
            border: none !important;
            border-radius: 8px !important;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1) !important;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.95) !important;
        }
        
        .theme-toggle i {
            font-size: 16px;
            color: #333;
        }
        
        /* Dark Theme Styles - UI Only */
        body.dark-theme .info {
            background: rgba(30, 30, 30, 0.83) !important;
            color: #ffffff !important;
        }
        
        body.dark-theme .info h2 {
            color: #ffffff !important;
        }
        
        body.dark-theme .leaflet-bar {
            background: rgba(40, 40, 40, 0.83) !important;
        }
        
        body.dark-theme .leaflet-bar a {
            background-color: rgba(40, 40, 40, 0.83) !important;
            color: #ffffff !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }
        
        body.dark-theme .leaflet-bar a:hover {
            background-color: rgba(60, 60, 60, 0.83) !important;
        }
        
        body.dark-theme .leaflet-control-layers {
            background: rgba(30, 30, 30, 0.83) !important;
            color: #ffffff !important;
        }
        
        body.dark-theme .leaflet-control-layers-toggle {
            background-color: rgba(40, 40, 40, 0.83) !important;
        }
        
        body.dark-theme .leaflet-control-custom {
            background: rgba(30, 30, 30, 0.83) !important;
        }
        
        body.dark-theme .leaflet-control-custom input {
            background: rgba(50, 50, 50, 0.9) !important;
            color: #ffffff !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
        }
        
        body.dark-theme .leaflet-control-custom input::placeholder {
            color: rgba(255, 255, 255, 0.5) !important;
        }
        
        body.dark-theme .theme-toggle {
            background: rgba(40, 40, 40, 0.83) !important;
        }
        
        body.dark-theme .theme-toggle i {
            color: #ffffff !important;
        }
        
        /* Header & Footer Styles */
        body {
            display: flex;
            flex-direction: column;
        }
        
        header {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 10000;
            padding: 12px 0;
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: rgba(255, 255, 255, 0.72);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        body.dark-theme header {
            background: rgba(30, 30, 30, 0.72);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
            letter-spacing: -0.5px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .logo-images {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo-images img {
            height: 35px;
            width: auto;
            object-fit: contain;
        }
        
        body.dark-theme .logo {
            color: #f5f5f7;
        }
        
        .header-nav {
            display: flex;
            gap: 25px;
            align-items: center;
        }
        
        .header-nav a {
            text-decoration: none;
            color: #1d1d1f;
            font-size: 14px;
            font-weight: 500;
            transition: opacity 0.2s;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .header-nav a:hover {
            opacity: 0.7;
        }
        
        body.dark-theme .header-nav a {
            color: #f5f5f7;
        }
        
        .header-theme-toggle {
            background: rgba(0, 0, 0, 0.05);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .header-theme-toggle:hover {
            background: rgba(0, 0, 0, 0.1);
        }
        
        body.dark-theme .header-theme-toggle {
            background: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-theme .header-theme-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .header-theme-toggle i {
            font-size: 14px;
            color: #1d1d1f;
        }
        
        body.dark-theme .header-theme-toggle i {
            color: #f5f5f7;
        }
        
        .header-lang-toggle {
            background: rgba(0, 0, 0, 0.05);
            border: none;
            padding: 6px 14px;
            border-radius: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 12px;
            font-weight: 600;
            color: #1d1d1f;
            gap: 5px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .header-lang-toggle:hover {
            background: rgba(0, 0, 0, 0.1);
        }
        
        body.dark-theme .header-lang-toggle {
            background: rgba(255, 255, 255, 0.1);
            color: #f5f5f7;
        }
        
        body.dark-theme .header-lang-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 10000;
            padding: 12px 0;
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: rgba(255, 255, 255, 0.72);
            border-top: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        body.dark-theme footer {
            background: rgba(30, 30, 30, 0.72);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .footer-content p {
            color: #6e6e73;
            font-size: 12px;
            margin: 0;
        }
        
        body.dark-theme .footer-content p {
            color: #a1a1a6;
        }
        
        .footer-logos {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .footer-logos img {
            height: 45px;
            width: auto;
            object-fit: contain;
        }
        
        .footer-links {
            display: flex;
            gap: 20px;
        }
        
        .footer-links a {
            color: #0071e3;
            text-decoration: none;
            font-size: 12px;
            transition: opacity 0.2s;
        }
        
        .footer-links a:hover {
            opacity: 0.7;
        }
        
        body.dark-theme .footer-links a {
            color: #0a84ff;
        }
        
        #map {
            margin-top: 50px;
            margin-bottom: 50px;
            height: calc(100vh - 100px) !important;
        }
        
        /* Adjust bottom controls to avoid footer overlap */
        .leaflet-bottom {
            bottom: 60px !important;
        }
        
        @media (max-width: 768px) {
            .header-nav {
                gap: 15px;
            }
            
            .header-nav a {
                font-size: 12px;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 10px;
            }
        }
        </style>
        <title>Peta Persebaran Restoran Cepat Saji di Area Mojolangu</title>
    </head>
    <body>
        <!-- Header -->
        <header>
            <div class="header-container">
                <div class="logo">
                    <div class="logo-images">
                        <img src="images/Logo.png" alt="Logo ITB ASIA">
                        <img src="images/logo-prodi-ti.png" alt="Logo Prodi TI">
                    </div>
                    <span>WebGIS Mojolangu</span>
                </div>
                <nav class="header-nav">
                    <a href="index.html" data-lang-id="nav-home">Beranda</a>
                    <a href="index.html#about" data-lang-id="nav-about">Tentang</a>
                    <button class="header-lang-toggle" id="headerLangToggle">
                        <i class="fas fa-globe"></i>
                        <span id="headerLangText">EN</span>
                    </button>
                    <button class="header-theme-toggle" id="headerThemeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </nav>
            </div>
        </header>
        
        <div id="map">
        </div>
        
        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="footer-logos">
                        <img src="images/Logo.png" alt="Logo ITB ASIA">
                        <img src="images/logo-prodi-ti.png" alt="Logo Prodi TI">
                    </div>
                    <p data-lang-id="footer-text">&copy; 2026 WebGIS Mojolangu. Dibangun dengan Leaflet.js & QGIS.</p>
                </div>
                <div class="footer-links">
                    <a href="index.html" data-lang-id="footer-home">Beranda</a>
                    <a href="index.html#about" data-lang-id="footer-about">Tentang</a>
                </div>
            </div>
        </footer>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet-svg-shape-markers.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="data/kelurahan_1.js"></script>
        <script src="data/Pemukiman_2.js"></script>
        <script src="data/FasilitasUmum_3.js"></script>
        <script src="data/RestoranCepatSaji_4.js"></script>
        <script src="data/JalanRaya_5.js"></script>
        <script src="data/JalanDesa_6.js"></script>
        <script src="data/JalanPerumahan_7.js"></script>
        <script src="data/JalanGang_8.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
              highlightLayer.setStyle({
                color: 'rgba(255, 255, 0, 1.00)',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: 'rgba(255, 255, 0, 1.00)',
                fillOpacity: 1
              });
            }
        }
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[-7.947262707796156,112.61770557889345],[-7.92627554876903,112.65710131073409]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // modify popup if contains media
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.update();
                    }, 10);
                } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                    var audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = src;
                    imgTd.parentNode.replaceChild(audio, imgTd);
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                    var video = document.createElement('video');
                    video.controls = true;
                    video.src = src;
                    video.style.width = "400px";
                    video.style.height = "300px";
                    video.style.maxHeight = "60vh";
                    video.style.maxWidth = "60vw";
                    imgTd.parentNode.replaceChild(video, imgTd);
                    popup._contentNode.classList.add('media');
                    // Aggiorna il popup quando il video carica i metadati
                    video.addEventListener('loadedmetadata', function() {
                        popup.update();
                    });
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var title = new L.Control({'position':'topleft'});
        title.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this._div.style.marginTop = '10px';
            this._div.style.maxWidth = '280px';
            this.update();
            return this._div;
        };
        title.update = function () {
            this._div.innerHTML = '<h2 data-lang-id="map-title">Peta Persebaran Restoran Cepat Saji</h2><p style="font-size: 12px; color: #6e6e73; margin: 5px 0 0 0; line-height: 1.4;" data-lang-id="map-subtitle">Area Mojolangu</p>';
        };
        title.addTo(map);
        
        // Abstract Control
        var abstract = L.control({position: 'bottomleft'});
        var abstractExpanded = true;
        abstract.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'abstractUncollapsed');
            this._div.style.maxWidth = '350px';
            this.update();
            return this._div;
        };
        abstract.update = function () {
            if (abstractExpanded) {
                this._div.className = 'abstractUncollapsed';
                this._div.innerHTML = '<button class="abstract-toggle-btn" title="Hide Abstract"><i class="fas fa-times"></i></button>' +
                    '<h3 style="font-size: 15px; font-weight: 600; color: #1d1d1f; margin: 0 0 10px 0;" data-lang-id="abstract-title">Abstrak</h3>' +
                    '<p style="margin: 0; font-size: 13px; line-height: 1.6; color: #6e6e73;" data-lang-id="abstract-text">' +
                    'Aplikasi WebGIS ini menyajikan analisis spasial interaktif dari persebaran restoran cepat saji di area Mojolangu, Malang. ' +
                    'Peta ini menggabungkan beberapa layer geografis termasuk batas administratif (kelurahan), area pemukiman, ' +
                    'fasilitas umum, dan jaringan jalan yang komprehensif (jalan raya, jalan desa, jalan perumahan, jalan gang). ' +
                    'Total 12 restoran cepat saji telah dipetakan dan didokumentasikan dengan data lokasi yang detail, memungkinkan wawasan berbasis data ' +
                    'untuk perencanaan perkotaan, analisis lokasi bisnis, dan studi aksesibilitas spasial.' +
                    '</p>';
                // Add click event to close button
                var closeBtn = this._div.querySelector('.abstract-toggle-btn');
                if (closeBtn) {
                    L.DomEvent.on(closeBtn, 'click', function(e) {
                        L.DomEvent.stopPropagation(e);
                        abstractExpanded = false;
                        abstract.update();
                    });
                }
            } else {
                this._div.className = 'abstractCollapsed';
                this._div.innerHTML = '<button class="abstract-collapsed-btn" title="Show Abstract"><i class="fas fa-info-circle"></i></button>';
                // Add click event to open button
                var openBtn = this._div.querySelector('.abstract-collapsed-btn');
                if (openBtn) {
                    L.DomEvent.on(openBtn, 'click', function(e) {
                        L.DomEvent.stopPropagation(e);
                        abstractExpanded = true;
                        abstract.update();
                        // Reapply language after reopening
                        if (typeof switchLanguage === 'function') {
                            switchLanguage(currentLang);
                        }
                    });
                }
            }
        };
        abstract.addTo(map);
        
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        
        // Custom Search Control
        var SearchControl = L.Control.extend({
            options: {
                position: 'topright'
            },
            
            onAdd: function(map) {
                var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');
                container.style.backgroundColor = 'white';
                
                // Create search icon button
                var searchIcon = L.DomUtil.create('a', '', container);
                searchIcon.href = '#';
                searchIcon.title = 'Search';
                searchIcon.innerHTML = '<i class="fas fa-search"></i>';
                searchIcon.style.width = '30px';
                searchIcon.style.height = '30px';
                searchIcon.style.lineHeight = '30px';
                searchIcon.style.textAlign = 'center';
                searchIcon.style.display = 'block';
                searchIcon.style.fontSize = '16px';
                searchIcon.style.color = '#333';
                searchIcon.style.textDecoration = 'none';
                
                // Create search panel (hidden by default)
                var searchPanel = L.DomUtil.create('div', '', container);
                searchPanel.style.display = 'none';
                searchPanel.style.padding = '5px';
                searchPanel.style.width = '250px';
                searchPanel.style.marginTop = '5px';
                
                var searchInput = L.DomUtil.create('input', '', searchPanel);
                searchInput.type = 'text';
                searchInput.placeholder = 'Search features...';
                searchInput.style.width = '100%';
                searchInput.style.padding = '5px';
                searchInput.style.border = '1px solid #ccc';
                searchInput.style.borderRadius = '3px';
                
                var resultsDiv = L.DomUtil.create('div', '', searchPanel);
                resultsDiv.style.maxHeight = '200px';
                resultsDiv.style.overflowY = 'auto';
                resultsDiv.style.marginTop = '5px';
                resultsDiv.style.display = 'none';
                
                // Toggle search panel on icon click
                var isSearchOpen = false;
                searchIcon.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    isSearchOpen = !isSearchOpen;
                    if (isSearchOpen) {
                        searchPanel.style.display = 'block';
                        searchInput.focus();
                    } else {
                        searchPanel.style.display = 'none';
                        searchInput.value = '';
                        resultsDiv.innerHTML = '';
                        resultsDiv.style.display = 'none';
                    }
                });
                
                // Prevent map interactions when using search
                L.DomEvent.disableClickPropagation(container);
                L.DomEvent.disableScrollPropagation(container);
                
                var searchMarker = null;
                
                searchInput.addEventListener('input', function(e) {
                    var searchTerm = e.target.value.toLowerCase().trim();
                    resultsDiv.innerHTML = '';
                    
                    if (searchTerm.length < 2) {
                        resultsDiv.style.display = 'none';
                        return;
                    }
                    
                    var results = [];
                    var layers = [
                        {layer: layer_RestoranCepatSaji_4, type: 'Restoran'},
                        {layer: layer_FasilitasUmum_3, type: 'Fasilitas Umum'},
                        {layer: layer_Pemukiman_2, type: 'Pemukiman'},
                        {layer: layer_kelurahan_1, type: 'Kelurahan'}
                    ];
                    
                    layers.forEach(function(item) {
                        item.layer.eachLayer(function(layer) {
                            var props = layer.feature.properties;
                            var nama = props.Nama ? props.Nama.toLowerCase() : '';
                            
                            if (nama.includes(searchTerm)) {
                                results.push({
                                    layer: layer,
                                    name: props.Nama || 'Unnamed',
                                    type: item.type,
                                    properties: props
                                });
                            }
                        });
                    });
                    
                    if (results.length > 0) {
                        resultsDiv.style.display = 'block';
                        results.slice(0, 10).forEach(function(result) {
                            var resultItem = L.DomUtil.create('div', '', resultsDiv);
                            resultItem.style.padding = '5px';
                            resultItem.style.cursor = 'pointer';
                            resultItem.style.borderBottom = '1px solid #eee';
                            resultItem.innerHTML = '<strong>' + result.name + '</strong><br><small>' + result.type + '</small>';
                            
                            resultItem.addEventListener('mouseover', function() {
                                this.style.backgroundColor = '#f0f0f0';
                            });
                            
                            resultItem.addEventListener('mouseout', function() {
                                this.style.backgroundColor = 'white';
                            });
                            
                            resultItem.addEventListener('click', function() {
                                // Remove previous search marker
                                if (searchMarker) {
                                    map.removeLayer(searchMarker);
                                }
                                
                                var latlng;
                                if (result.layer.feature.geometry.type === 'Point') {
                                    var coords = result.layer.feature.geometry.coordinates;
                                    latlng = L.latLng(coords[1], coords[0]);
                                } else if (result.layer.getBounds) {
                                    latlng = result.layer.getBounds().getCenter();
                                }
                                
                                if (latlng) {
                                    // Add search marker
                                    searchMarker = L.marker(latlng, {
                                        icon: L.icon({
                                            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                                            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
                                            iconSize: [25, 41],
                                            iconAnchor: [12, 41],
                                            popupAnchor: [1, -34],
                                            shadowSize: [41, 41]
                                        })
                                    }).addTo(map);
                                    
                                    map.setView(latlng, 17);
                                    result.layer.openPopup();
                                }
                                
                                resultsDiv.style.display = 'none';
                                searchInput.value = result.name;
                            });
                        });
                    } else {
                        resultsDiv.style.display = 'block';
                        resultsDiv.innerHTML = '<div style="padding: 5px; color: #999;">No results found</div>';
                    }
                });
                
                return container;
            }
        });
        
        map.addControl(new SearchControl());
        
        // Sync header theme toggle
        const headerThemeToggle = document.getElementById('headerThemeToggle');
        let headerIsDarkTheme = false;
        
        headerThemeToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            headerIsDarkTheme = !headerIsDarkTheme;
            
            if (headerIsDarkTheme) {
                document.body.classList.add('dark-theme');
                this.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.body.classList.remove('dark-theme');
                this.innerHTML = '<i class="fas fa-moon"></i>';
            }
        });
        
        // Language Toggle
        const translations = {
            id: {
                'nav-home': 'Beranda',
                'nav-about': 'Tentang',
                'map-title': 'Peta Persebaran Restoran Cepat Saji',
                'map-subtitle': 'Area Mojolangu',
                'abstract-title': 'Abstrak',
                'abstract-text': 'Aplikasi WebGIS ini menyajikan analisis spasial interaktif dari persebaran restoran cepat saji di area Mojolangu, Malang. Peta ini menggabungkan beberapa layer geografis termasuk batas administratif (kelurahan), area pemukiman, fasilitas umum, dan jaringan jalan yang komprehensif (jalan raya, jalan desa, jalan perumahan, jalan gang). Total 12 restoran cepat saji telah dipetakan dan didokumentasikan dengan data lokasi yang detail, memungkinkan wawasan berbasis data untuk perencanaan perkotaan, analisis lokasi bisnis, dan studi aksesibilitas spasial.',
                'footer-text': '&copy; 2026 WebGIS Mojolangu. Dibangun dengan Leaflet.js & QGIS.',
                'footer-home': 'Beranda',
                'footer-about': 'Tentang'
            },
            en: {
                'nav-home': 'Home',
                'nav-overview': 'Overview',
                'nav-about': 'About',
                'map-title': 'Fast Food Restaurant Distribution Map',
                'map-subtitle': 'Mojolangu Area',
                'abstract-title': 'Abstract',
                'abstract-text': 'This WebGIS application presents an interactive spatial analysis of fast food restaurant distribution in the Mojolangu area, Malang. The map incorporates multiple geographic layers including administrative boundaries (kelurahan), residential areas (pemukiman), public facilities (fasilitas umum), and comprehensive road networks (jalan raya, jalan desa, jalan perumahan, jalan gang). A total of 12 fast food restaurants have been mapped and documented with detailed location data, enabling data-driven insights for urban planning, business location analysis, and spatial accessibility studies.',
                'footer-text': '&copy; 2026 WebGIS Mojolangu. Built with Leaflet.js & QGIS.',
                'footer-home': 'Home',
                'footer-overview': 'Overview',
                'footer-about': 'About'
            }
        };
        
        let currentLang = 'id';
        const headerLangToggle = document.getElementById('headerLangToggle');
        const headerLangText = document.getElementById('headerLangText');
        
        function switchLanguage(lang) {
            currentLang = lang;
            const elements = document.querySelectorAll('[data-lang-id]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang-id');
                if (translations[lang][key]) {
                    element.innerHTML = translations[lang][key];
                }
            });
            headerLangText.textContent = lang === 'id' ? 'EN' : 'ID';
        }
        
        headerLangToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            switchLanguage(currentLang === 'id' ? 'en' : 'id');
        });
        
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_OpenStreetMap_0');
        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
        var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OpenStreetMap_0;
        map.addLayer(layer_OpenStreetMap_0);
        function pop_kelurahan_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nama'] !== null ? autolinker.link(String(feature.properties['Nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kode Pos'] !== null ? autolinker.link(String(feature.properties['Kode Pos']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['JumlahPend'] !== null ? autolinker.link(String(feature.properties['JumlahPend']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Luas'] !== null ? autolinker.link(String(feature.properties['Luas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Panjang'] !== null ? autolinker.link(String(feature.properties['Panjang']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Hektar'] !== null ? autolinker.link(String(feature.properties['Hektar']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_kelurahan_1_0() {
            return {
                pane: 'pane_kelurahan_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.7,
                fillColor: 'rgba(204,85,0,0.7)',
                interactive: true,
            }
        }
        map.createPane('pane_kelurahan_1');
        map.getPane('pane_kelurahan_1').style.zIndex = 401;
        map.getPane('pane_kelurahan_1').style['mix-blend-mode'] = 'normal';
        var layer_kelurahan_1 = new L.geoJson(json_kelurahan_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_kelurahan_1',
            layerName: 'layer_kelurahan_1',
            pane: 'pane_kelurahan_1',
            onEachFeature: pop_kelurahan_1,
            style: style_kelurahan_1_0,
        });
        bounds_group.addLayer(layer_kelurahan_1);
        map.addLayer(layer_kelurahan_1);
        function pop_Pemukiman_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nama'] !== null ? autolinker.link(String(feature.properties['Nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Luas'] !== null ? autolinker.link(String(feature.properties['Luas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Panjang'] !== null ? autolinker.link(String(feature.properties['Panjang']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Hektar'] !== null ? autolinker.link(String(feature.properties['Hektar']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Pemukiman_2_0() {
            return {
                pane: 'pane_Pemukiman_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.7,
                fillColor: 'rgba(177,213,255,0.7)',
                interactive: true,
            }
        }
        map.createPane('pane_Pemukiman_2');
        map.getPane('pane_Pemukiman_2').style.zIndex = 402;
        map.getPane('pane_Pemukiman_2').style['mix-blend-mode'] = 'normal';
        var layer_Pemukiman_2 = new L.geoJson(json_Pemukiman_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Pemukiman_2',
            layerName: 'layer_Pemukiman_2',
            pane: 'pane_Pemukiman_2',
            onEachFeature: pop_Pemukiman_2,
            style: style_Pemukiman_2_0,
        });
        bounds_group.addLayer(layer_Pemukiman_2);
        map.addLayer(layer_Pemukiman_2);
        function pop_FasilitasUmum_3(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nama'] !== null ? autolinker.link(String(feature.properties['Nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Luas'] !== null ? autolinker.link(String(feature.properties['Luas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Panjang'] !== null ? autolinker.link(String(feature.properties['Panjang']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Hektar'] !== null ? autolinker.link(String(feature.properties['Hektar']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_FasilitasUmum_3_0() {
            return {
                pane: 'pane_FasilitasUmum_3',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.7,
                fillColor: 'rgba(125,139,143,0.7)',
                interactive: true,
            }
        }
        map.createPane('pane_FasilitasUmum_3');
        map.getPane('pane_FasilitasUmum_3').style.zIndex = 403;
        map.getPane('pane_FasilitasUmum_3').style['mix-blend-mode'] = 'normal';
        var layer_FasilitasUmum_3 = new L.geoJson(json_FasilitasUmum_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_FasilitasUmum_3',
            layerName: 'layer_FasilitasUmum_3',
            pane: 'pane_FasilitasUmum_3',
            onEachFeature: pop_FasilitasUmum_3,
            style: style_FasilitasUmum_3_0,
        });
        bounds_group.addLayer(layer_FasilitasUmum_3);
        map.addLayer(layer_FasilitasUmum_3);
        function pop_RestoranCepatSaji_4(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nama'] !== null ? autolinker.link(String(feature.properties['Nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Link Maps'] !== null ? autolinker.link(String(feature.properties['Link Maps']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['No. Telp'] !== null ? autolinker.link(String(feature.properties['No. Telp']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_RestoranCepatSaji_4_0() {
            return {
                pane: 'pane_RestoranCepatSaji_4',
                shape: 'diamond',
                radius: 8.8,
                opacity: 1,
                color: 'rgba(61,128,53,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(0,255,231,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_RestoranCepatSaji_4');
        map.getPane('pane_RestoranCepatSaji_4').style.zIndex = 404;
        map.getPane('pane_RestoranCepatSaji_4').style['mix-blend-mode'] = 'normal';
        var layer_RestoranCepatSaji_4 = new L.geoJson(json_RestoranCepatSaji_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_RestoranCepatSaji_4',
            layerName: 'layer_RestoranCepatSaji_4',
            pane: 'pane_RestoranCepatSaji_4',
            onEachFeature: pop_RestoranCepatSaji_4,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.shapeMarker(latlng, style_RestoranCepatSaji_4_0(feature));
            },
        });
        bounds_group.addLayer(layer_RestoranCepatSaji_4);
        map.addLayer(layer_RestoranCepatSaji_4);
        function pop_JalanRaya_5(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nama'] !== null ? autolinker.link(String(feature.properties['Nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Panjang'] !== null ? autolinker.link(String(feature.properties['Panjang']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kilometer'] !== null ? autolinker.link(String(feature.properties['Kilometer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_JalanRaya_5_0() {
            return {
                pane: 'pane_JalanRaya_5',
                opacity: 1,
                color: 'rgba(0,255,111,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_JalanRaya_5');
        map.getPane('pane_JalanRaya_5').style.zIndex = 405;
        map.getPane('pane_JalanRaya_5').style['mix-blend-mode'] = 'normal';
        var layer_JalanRaya_5 = new L.geoJson(json_JalanRaya_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_JalanRaya_5',
            layerName: 'layer_JalanRaya_5',
            pane: 'pane_JalanRaya_5',
            onEachFeature: pop_JalanRaya_5,
            style: style_JalanRaya_5_0,
        });
        bounds_group.addLayer(layer_JalanRaya_5);
        map.addLayer(layer_JalanRaya_5);
        function pop_JalanDesa_6(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nama'] !== null ? autolinker.link(String(feature.properties['Nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Panjang'] !== null ? autolinker.link(String(feature.properties['Panjang']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kilometer'] !== null ? autolinker.link(String(feature.properties['Kilometer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_JalanDesa_6_0() {
            return {
                pane: 'pane_JalanDesa_6',
                opacity: 1,
                color: 'rgba(255,158,23,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_JalanDesa_6');
        map.getPane('pane_JalanDesa_6').style.zIndex = 406;
        map.getPane('pane_JalanDesa_6').style['mix-blend-mode'] = 'normal';
        var layer_JalanDesa_6 = new L.geoJson(json_JalanDesa_6, {
            attribution: '',
            interactive: true,
            dataVar: 'json_JalanDesa_6',
            layerName: 'layer_JalanDesa_6',
            pane: 'pane_JalanDesa_6',
            onEachFeature: pop_JalanDesa_6,
            style: style_JalanDesa_6_0,
        });
        bounds_group.addLayer(layer_JalanDesa_6);
        map.addLayer(layer_JalanDesa_6);
        function pop_JalanPerumahan_7(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nama'] !== null ? autolinker.link(String(feature.properties['Nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Panjang'] !== null ? autolinker.link(String(feature.properties['Panjang']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kilometer'] !== null ? autolinker.link(String(feature.properties['Kilometer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_JalanPerumahan_7_0() {
            return {
                pane: 'pane_JalanPerumahan_7',
                opacity: 1,
                color: 'rgba(200,64,243,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_JalanPerumahan_7');
        map.getPane('pane_JalanPerumahan_7').style.zIndex = 407;
        map.getPane('pane_JalanPerumahan_7').style['mix-blend-mode'] = 'normal';
        var layer_JalanPerumahan_7 = new L.geoJson(json_JalanPerumahan_7, {
            attribution: '',
            interactive: true,
            dataVar: 'json_JalanPerumahan_7',
            layerName: 'layer_JalanPerumahan_7',
            pane: 'pane_JalanPerumahan_7',
            onEachFeature: pop_JalanPerumahan_7,
            style: style_JalanPerumahan_7_0,
        });
        bounds_group.addLayer(layer_JalanPerumahan_7);
        map.addLayer(layer_JalanPerumahan_7);
        function pop_JalanGang_8(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Nama'] !== null ? autolinker.link(String(feature.properties['Nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Panjang'] !== null ? autolinker.link(String(feature.properties['Panjang']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Kilometer'] !== null ? autolinker.link(String(feature.properties['Kilometer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_JalanGang_8_0() {
            return {
                pane: 'pane_JalanGang_8',
                opacity: 1,
                color: 'rgba(255,191,232,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_JalanGang_8');
        map.getPane('pane_JalanGang_8').style.zIndex = 408;
        map.getPane('pane_JalanGang_8').style['mix-blend-mode'] = 'normal';
        var layer_JalanGang_8 = new L.geoJson(json_JalanGang_8, {
            attribution: '',
            interactive: true,
            dataVar: 'json_JalanGang_8',
            layerName: 'layer_JalanGang_8',
            pane: 'pane_JalanGang_8',
            onEachFeature: pop_JalanGang_8,
            style: style_JalanGang_8_0,
        });
        bounds_group.addLayer(layer_JalanGang_8);
        map.addLayer(layer_JalanGang_8);
        var overlaysTree = [
            {label: '<img src="legend/JalanGang_8.png" /> Jalan Gang', layer: layer_JalanGang_8},
            {label: '<img src="legend/JalanPerumahan_7.png" /> Jalan Perumahan', layer: layer_JalanPerumahan_7},
            {label: '<img src="legend/JalanDesa_6.png" /> Jalan Desa', layer: layer_JalanDesa_6},
            {label: '<img src="legend/JalanRaya_5.png" /> Jalan Raya', layer: layer_JalanRaya_5},
            {label: '<img src="legend/RestoranCepatSaji_4.png" /> Restoran Cepat Saji', layer: layer_RestoranCepatSaji_4},
            {label: '<img src="legend/FasilitasUmum_3.png" /> Fasilitas Umum', layer: layer_FasilitasUmum_3},
            {label: '<img src="legend/Pemukiman_2.png" /> Pemukiman', layer: layer_Pemukiman_2},
            {label: '<img src="legend/kelurahan_1.png" /> kelurahan', layer: layer_kelurahan_1},
            {label: "OpenStreetMap", layer: layer_OpenStreetMap_0},]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: false, 
        });
        lay.addTo(map);
		document.addEventListener("DOMContentLoaded", function() {
            // set new Layers List height which considers toggle icon
            function newLayersListHeight() {
                var layerScrollbarElement = document.querySelector('.leaflet-control-layers-scrollbar');
                if (layerScrollbarElement) {
                    var layersListElement = document.querySelector('.leaflet-control-layers-list');
                    var originalHeight = layersListElement.style.height 
                        || window.getComputedStyle(layersListElement).height;
                    var newHeight = parseFloat(originalHeight) - 50;
                    layersListElement.style.height = newHeight + 'px';
                }
            }
            var isLayersListExpanded = true;
            var controlLayersElement = document.querySelector('.leaflet-control-layers');
            var toggleLayerControl = document.querySelector('.leaflet-control-layers-toggle');
            // toggle Collapsed/Expanded and apply new Layers List height
            toggleLayerControl.addEventListener('click', function() {
                if (isLayersListExpanded) {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                } else {
                    controlLayersElement.classList.add('leaflet-control-layers-expanded');
                }
                isLayersListExpanded = !isLayersListExpanded;
                newLayersListHeight()
            });	
			// apply new Layers List height if toggle layerstree
			if (controlLayersElement) {
				controlLayersElement.addEventListener('click', function(event) {
					var toggleLayerHeaderPointer = event.target.closest('.leaflet-layerstree-header-pointer span');
					if (toggleLayerHeaderPointer) {
						newLayersListHeight();
					}
				});
			}
            // Collapsed/Expanded at Start to apply new height
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            // Collapsed touch/small screen
            var isSmallScreen = window.innerWidth < 650;
            if (isSmallScreen) {
                setTimeout(function() {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                    isLayersListExpanded = !isLayersListExpanded;
                }, 500);
            }  
        });       
        setBounds();
        var i = 0;
        layer_kelurahan_1.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Nama']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_kelurahan_1'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_Pemukiman_2.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Nama']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Pemukiman_2'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_FasilitasUmum_3.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Nama']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_FasilitasUmum_3'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_RestoranCepatSaji_4.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Nama']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_RestoranCepatSaji_4'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_JalanRaya_5.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Nama']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_JalanRaya_5'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_JalanDesa_6.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Nama']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_JalanDesa_6'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_JalanPerumahan_7.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Nama']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_JalanPerumahan_7'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_JalanGang_8.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Nama']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_JalanGang_8'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        resetLabels([layer_kelurahan_1,layer_Pemukiman_2,layer_FasilitasUmum_3,layer_RestoranCepatSaji_4,layer_JalanRaya_5,layer_JalanDesa_6,layer_JalanPerumahan_7,layer_JalanGang_8]);
        map.on("zoomend", function(){
            resetLabels([layer_kelurahan_1,layer_Pemukiman_2,layer_FasilitasUmum_3,layer_RestoranCepatSaji_4,layer_JalanRaya_5,layer_JalanDesa_6,layer_JalanPerumahan_7,layer_JalanGang_8]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_kelurahan_1,layer_Pemukiman_2,layer_FasilitasUmum_3,layer_RestoranCepatSaji_4,layer_JalanRaya_5,layer_JalanDesa_6,layer_JalanPerumahan_7,layer_JalanGang_8]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_kelurahan_1,layer_Pemukiman_2,layer_FasilitasUmum_3,layer_RestoranCepatSaji_4,layer_JalanRaya_5,layer_JalanDesa_6,layer_JalanPerumahan_7,layer_JalanGang_8]);
        });
        </script>        
    </body>
</html>
